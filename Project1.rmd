---
title: "Statistical Inference Course Project"
author: "Chris van Hasselt"
date: "Monday, May 24, 2015"
output:
  pdf_document:
    fig_height: 3.75
    fig_width: 5
    latex_engine: xelatex
---
```{r libraries, echo=FALSE }
# libraries loaded here
library(ggplot2)
```

# Overview:
The exponential distribution can be simulated in R with *rexp(n, lambda)* where *lambda* is the rate parameter. The mean of exponential distribution is *1/lambda* and the standard deviation is also also *1/lambda*. In this report, I will investigate the distribution of averages of 40 exponentials, when the rate parameter *lambda = 0.2*.

Specifically, I illustrate the properties of the distribution of the mean of 40 exponentials, showing:

#. The sample mean and compare it to the theoretical mean of the distribution;
#. variability (via variance) with respect to the theoretical variance of the distribution;
#. that the distribution is approximately normal.

Plots generated in this document are created using the *ggplot2* library.

# Simulations:
To analyze empirical versus theoretical statistics, I create a data.frame named *dfSamples* of random exponential values based on the given rate, *lambda = 0.2*.  Code available in the Appendix.

```{r introduction,echo=FALSE}

set.seed(2132)          # set random seed, for repeatability

lambda <- 0.2           # define lambda, the exponential rate

numSimulations <- 1000  # numSimulations = number of simulations (1000)

sampleSize <- 40        # sampleSize = number of exponentials per simulation (40)

# allSamples is the numSimulations (1000) times sampleSize (40) exponentials
allSamples <- rexp(sampleSize*numSimulations, rate=lambda)

# sampleMatrix packages the exponentials as a matrix 
sampleMatrix <- matrix(allSamples, numSimulations)

# dfSamples is a data.frame of all the samples
dfSamples   <- as.data.frame(sampleMatrix)

```
# Sample Mean versus Theoretical Mean:
To compare the empirical mean to the the theoretical mean, I calculate row means for data.frame *dfSamples* as *xbar*, and cumulative row means as *xbarCumulative*.  The plot below shows the means of samples of 40 exponentials converging toward the theoretical mean of *1/lambda*, in this case 5, demonstrating asymptotic convergence to the theoretical mean.
```{r compare_mean, echo=FALSE}

# dfSamples$xbar is a column appended of row means
dfSamples$xbar <- apply(dfSamples, 1, mean)

# dfSamples$xbarCumulative is appended as a column of cumulative means
dfSamples$xbarCumulative <- cumsum(dfSamples$xbar)/(1:numSimulations)

xbarTheoretical <- 1 / lambda  # the theoretical mean 

# Prepare plot of cumulative means, demonstrating convergence to the theoretical mean
meanPlot <- ggplot(data.frame(x = 1:numSimulations,
                              y = dfSamples$xbarCumulative),
            aes(x = x, y = y)) + geom_line() +
            geom_hline(aes(yintercept=xbarTheoretical,
                           color="red")) +
                geom_text(aes(750,xbarTheoretical,
                              label = "mean = 5",
                              vjust = 1,
                              hjust = 0)) +
            labs(title='Exponential Means: Empirical vs. Theoretical',
                 x='Simulations',y='Means')
```
```{r plotConvergence,echo=FALSE}
# display the plot
meanPlot
```


# Sample Variance versus Theoretical Variance

The theoretical variance of exponential samples is *(1/lambda) ^ 2*.  Computing the variance of the samples for the one thousand samples, I plot the rolling value of the variance as *n* increases. Plotting this with the expected theoretical value of the variance demonstrates the asymptotic convergence of the variance.

```{r compare_variance,echo=FALSE}
# Compute variance for each sample of 40 exponentials, and append to  data.frame
dfSamples$varEmpirical <- apply(dfSamples[,paste("V",1:40,sep="")],1,var) 

# Compute a rolling estimate of variance as the number of samples increases.
dfSamples$varCumulative <- cumsum(dfSamples$varEmpirical)/(1:numSimulations)

# compute the theoretical variance
varTheoretical <- (1/lambda) ^ 2 

# Prepate plot 
varPlot <- ggplot(data.frame(x = 1:numSimulations,
                             y = dfSamples$varCumulative),
            aes(x = x, y = y)) +
            geom_line() +
            geom_hline(aes(yintercept=varTheoretical,
                           color="red")) +
                geom_text(aes(750,varTheoretical,
                              label = "var = 25",
                              vjust = 1,
                              hjust = 0)) +
            labs(title='Exponential Variance: Empirical vs. Theoretical',
                 x='Simulations',y='Variance')

# diplay plot
varPlot
```

# The Distribution of the Means
We expect that the distribution of the means will be normal, centered around the theoretical mean. Plotting with relevant density overlaying the histogram, it is apparent that the distribution is approximately normal and centered around the mean.  The true normal distribution

```{r mean_distribution,echo=FALSE}
# display a plot of the histogram
xbarDist <- ggplot(data=dfSamples, aes(dfSamples$xbar)) + 
                geom_histogram(aes(y=..density..),
                               col="darkblue",fill="grey") +
                geom_density(alpha=.2, fill="#FF6666") + 
                geom_vline(aes(xintercept=xbarTheoretical,
                           color="red")) +
                geom_text(aes(xbarTheoretical,.5,
                              label = "mean = 5",
                              vjust = 1,
                              hjust = 1.2)) +
                stat_function(fun = dnorm, arg=list(mean=xbarTheoretical), 
                              colour = "#FFCC33",
                              size=1.2) +
                labs(title='Distribution of Means with Expected Normal Curve',
                     x='Computed Means',
                     y='Density')
xbarDist

```


# Appendix: Code Samples & Plots

## Libraries
```{r displayLibraries, ref.label='libraries',eval=FALSE }

```
## Generating Data
In the code below R generates a 1000 samples of 40 exponentials with lambda value of 0.2, converting it immediately to a data.frame named *dfSamples*.
```{r displayIntroduction,ref.label='introduction',eval=FALSE}

```
## Convergence of the Mean
The code below is used to compute the means, and prepare the plot of the convergence of the mean.
```{r displayCompare_Mean,ref.label='compare_mean',eval=FALSE}

```

